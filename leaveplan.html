<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Leave Plan Form</title>
<style>
  body {
    font-family: "Segoe UI", sans-serif;
    background: #f7f9fb;
    display: flex;
    justify-content: center;
    align-items: flex-start;
    min-height: 100vh;
    padding-top: 40px;
  }
  .container {
    background: #fff;
    padding: 25px 30px;
    border-radius: 10px;
    box-shadow: 0 0 10px rgba(0,0,0,0.1);
    width: 400px;
  }
  h2 {
    text-align: center;
    color: #333;
  }
  label { font-weight: bold; display: block; margin-top: 10px; }
  input {
    width: 100%; padding: 8px; margin-top: 5px;
    border: 1px solid #ccc; border-radius: 5px;
  }
  .period-group {
    margin-top: 10px;
    border: 1px solid #ddd;
    padding: 10px;
    border-radius: 6px;
    background: #f9fafc;
  }
  button {
    margin-top: 15px;
    width: 100%;
    padding: 10px;
    background: #0078d7;
    color: white;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    font-weight: bold;
  }
  .success, .error {
    text-align: center;
    margin-top: 15px;
    padding: 10px;
    border-radius: 6px;
  }
  .success { background: #e8f7ee; color: #107c10; }
  .error { background: #fdecea; color: #d93025; }
</style>
</head>
<body>
<div class="container">
  <h2>Leave Plan Form</h2>
  <form id="leaveForm">
    <label>Staff Name:</label>
    <input type="text" id="staffName" required placeholder="Enter your name">

    <label>RC No:</label>
    <input type="text" id="rcNo" required placeholder="Enter RC No">

    <div class="period-group">
      <h4>Period 1</h4>
      <label>Leave From:</label><input type="date" id="from1">
      <label>Leave To:</label><input type="date" id="to1">
    </div>
    <div class="period-group">
      <h4>Period 2</h4>
      <label>Leave From:</label><input type="date" id="from2">
      <label>Leave To:</label><input type="date" id="to2">
    </div>
    <div class="period-group">
      <h4>Period 3</h4>
      <label>Leave From:</label><input type="date" id="from3">
      <label>Leave To:</label><input type="date" id="to3">
    </div>

    <button type="submit">Submit Leave Plan</button>
  </form>
  <div id="message"></div>
</div>

<!-- Firebase SDKs -->
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>

<!-- Firebase Init -->
<script src="fireleave.js"></script>

<!-- Form Submission Logic -->
<script>
document.getElementById("leaveForm").addEventListener("submit", async function(e) {
  e.preventDefault();

  const name = document.getElementById("staffName").value.trim();
  const rcNo = document.getElementById("rcNo").value.trim();

  const periods = [];
  for (let i = 1; i <= 3; i++) {
    const from = document.getElementById("from" + i).value;
    const to = document.getElementById("to" + i).value;
    if (from && to) periods.push({ from, to });
  }

  if (!name || !rcNo || periods.length === 0) {
    alert("Please fill staff info and at least one leave period.");
    return;
  }

  const refNo = "LV-" + Date.now().toString().slice(-6);
  const now = new Date();
  const date = now.toLocaleDateString();
  const time = now.toLocaleTimeString();

  const leaveData = { staffName: name, rcNo, leavePeriods: periods, referenceNo: refNo, submitDate: date, submitTime: time };

  try {
    if (!window.cardDb) throw new Error("Firebase not initialized");
    await cardDb.collection("LeavePlans").add(leaveData);
    document.getElementById("message").innerHTML = `
      <div class="success">
        ‚úÖ Leave Plan submitted successfully!<br>
        Reference No: <b>${refNo}</b><br>
        Submitted on: ${date} at ${time}
      </div>
    `;
    document.getElementById("leaveForm").reset();
  } catch (error) {
    console.error("Error saving to Firestore:", error);
    document.getElementById("message").innerHTML =
      `<div class="error">‚ùå ${error.message}</div>`;
  }
});

// üî• AUTO TEST SUBMIT (after 1 minute)
setTimeout(() => {
  console.log("üß™ Auto-submitting test form after 1 minute...");
  document.getElementById("staffName").value = "Test User";
  document.getElementById("rcNo").value = "RC001";
  document.getElementById("from1").value = "2025-11-05";
  document.getElementById("to1").value = "2025-11-10";
  document.getElementById("leaveForm").dispatchEvent(new Event("submit"));
}, 60000); // 60,000 ms = 1 minute
</script>
</body>
</html>
