<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Duty Change System</title>
  <style>
    body { font-family: Arial, sans-serif; background:#f4f4f4; margin:0; padding:20px; }
    .container { display: flex; gap: 20px; width: 95%; max-width: 1400px; margin:auto; }
    .form-container { flex: 1; background:#fff; padding:20px; border-radius:10px; box-shadow:0 8px 20px rgba(0,0,0,0.1); }
    .entry-list { flex: 2; background:#fff; padding:20px; border-radius:10px; box-shadow:0 8px 20px rgba(0,0,0,0.1); }
    .form-row { margin-bottom: 12px; display:flex; flex-direction:column; }
    label { margin-bottom:5px; font-weight:bold; }
    input, select { padding:8px; border:1px solid #ccc; border-radius:6px; }
    button { padding:8px 14px; border:none; border-radius:6px; background:#007bff; color:white; cursor:pointer; }
    button:hover { background:#0056b3; }
    table { width:100%; border-collapse:collapse; margin-top:15px; }
    th, td { border:1px solid #ddd; padding:8px; text-align:left; }
    th { background:#f0f0f0; }
  </style>
</head>
<body>

  <h2>Duty Change Entry</h2>
  <div class="container">
    <!-- Entry Form -->
    <div class="form-container">
      <form id="entryForm">
        <div class="form-row">
          <label for="recipient">Name:</label>
          <!-- Admin dropdown -->
          <select id="recipientSelect" style="display:none"></select>
          <!-- Staff readonly -->
          <input type="text" id="recipientInput" readonly>
        </div>
        <div class="form-row">
          <label for="RcNo">RCNo:</label>
          <input type="text" id="RcNo" readonly>
        </div>
        <div class="form-row">
          <label for="date">Date:</label>
          <input type="date" id="date" required>
        </div>
        <div class="form-row">
          <label for="reason">Reason:</label>
          <input type="text" id="reason" required>
        </div>
        <button type="submit">Submit</button>
      </form>
    </div>

    <!-- Entry List -->
    <div class="entry-list">
      <h3>Submitted Entries</h3>
      <table id="entryTable">
        <thead>
          <tr>
            <th>Name</th>
            <th>RCNo</th>
            <th>Date</th>
            <th>Reason</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

  <!-- Load users first -->
  <script src="aqj.js"></script>
  <script>
    // Simulate logged in user
    const loggedInUser = { username: "admin" }; // change to "sobah" to test staff
    const isAdmin = loggedInUser.username === "admin";

    const recipientSelect = document.getElementById("recipientSelect");
    const recipientInput = document.getElementById("recipientInput");
    const rcInput = document.getElementById("RcNo");
    const entryForm = document.getElementById("entryForm");
    const entryTableBody = document.querySelector("#entryTable tbody");

    if (isAdmin) {
      // Show dropdown
      recipientInput.style.display = "none";
      recipientSelect.style.display = "block";

      // Default "choose" option
      const defaultOpt = document.createElement("option");
      defaultOpt.value = "";
      defaultOpt.textContent = "— Select Staff —";
      recipientSelect.appendChild(defaultOpt);

      // Fill dropdown from aqj.js
      users.forEach(u => {
        const opt = document.createElement("option");
        opt.value = u.name;
        opt.textContent = u.name;
        recipientSelect.appendChild(opt);
      });

      // Auto-fill RCNo when selecting staff
      recipientSelect.addEventListener("change", () => {
        const selUser = users.find(u => u.name === recipientSelect.value);
        rcInput.value = selUser ? selUser.rcNo : "";
      });

    } else {
      // Staff user
      recipientInput.style.display = "block";
      recipientSelect.style.display = "none";

      const me = users.find(u => u.username === loggedInUser.username);
      if (me) {
        recipientInput.value = me.name;
        rcInput.value = me.rcNo;
      }
    }

    // Handle form submit
    entryForm.addEventListener("submit", e => {
      e.preventDefault();

      const name = isAdmin ? recipientSelect.value : recipientInput.value;
      const rcNo = rcInput.value;
      const date = document.getElementById("date").value;
      const reason = document.getElementById("reason").value;

      if (!name || !rcNo) {
        alert("Please select a staff member.");
        return;
      }

      const row = document.createElement("tr");
      row.innerHTML = `<td>${name}</td><td>${rcNo}</td><td>${date}</td><td>${reason}</td>`;
      entryTableBody.appendChild(row);

      entryForm.reset();
      if (isAdmin) {
        recipientSelect.selectedIndex = 0;
        rcInput.value = "";
      }
    });
  </script>
</body>
</html>
