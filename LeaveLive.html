<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Leave Report</title>
<style>
  body { font-family: Arial, sans-serif; background: #eef2f7; margin: 0; padding: 20px; }
  table { width: 100%; border-collapse: collapse; margin-top: 20px; background: white; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
  th, td { border: 1px solid #ccc; padding: 8px; text-align: center; font-size: 14px; }
  th { background: #007bff; color: white; }
  button { padding: 5px 10px; border: none; border-radius: 4px; cursor: pointer; }
  .apply-btn { background: #28a745; color: white; }
  .apply-btn.applied { background: gray; cursor: default; }
  .delete-btn { background: red; color: white; }
</style>
</head>
<body>

<h2 style="text-align:center;">All Leave Entries</h2>
<table>
  <thead>
    <tr>
      <th>Date</th>
      <th>Staff</th>
      <th>RC No</th>
      <th>Leave</th>
      <th>Reason</th>
      <th>Duty</th>
      <th>Submitted</th>
      <th>Status</th>
      <th>Action</th>
    </tr>
  </thead>
  <tbody id="reportList"></tbody>
</table>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="sca.js"></script>
<script>
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

const reportList = document.getElementById("reportList");

function loadReports(){
  db.collection("leave_entries").orderBy("timestamp","desc")
    .onSnapshot(snapshot=>{
      reportList.innerHTML = "";
      snapshot.forEach(docSnap=>{
        const d = docSnap.data();
        const status = d.status || "pending";
        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${d.date}</td>
          <td>${d.staff}</td>
          <td>${d.rcNo}</td>
          <td>${d.leave}</td>
          <td>${d.reason}</td>
          <td>${d.duty}</td>
          <td>${d.submitTime || "-"}</td>
          <td>${status}</td>
          <td>
            <button class="apply-btn ${status==='applied'?'applied':''}" ${status==='applied'?'disabled':''}>Apply</button>
            <button class="delete-btn">Delete</button>
          </td>
        `;
        const applyBtn = row.querySelector(".apply-btn");
        const deleteBtn = row.querySelector(".delete-btn");

        applyBtn.onclick = async ()=>{
          if(status !== "applied"){
            await db.collection("leave_entries").doc(docSnap.id).update({ status:"applied" });
          }
        };

        deleteBtn.onclick = async ()=>{
          if(confirm("Delete this entry?")){
            await db.collection("leave_entries").doc(docSnap.id).delete();
          }
        };

        reportList.appendChild(row);
      });
    });
}
loadReports();
</script>
</body>
</html>
